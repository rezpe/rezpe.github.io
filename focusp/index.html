<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Status Manager</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Task Name Header -->
        <header class="mb-8">
            <div class="flex items-center space-x-3 mb-4">
                <h1 class="text-4xl font-bold text-gray-800">Multi-Project Dashboard</h1>
                <button 
                    @click="showApiKeyInput = !showApiKeyInput"
                    class="text-2xl hover:text-gray-600 transition-colors"
                    title="API Settings"
                >
                    ⚙️
                </button>
            </div>
            
            <!-- API Key Input Area -->
            <div v-if="showApiKeyInput" class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-4 space-y-4">
                <!-- Provider Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">AI Provider</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center">
                            <input type="radio" v-model="tempProvider" value="openai" class="mr-2">
                            <span class="text-sm">OpenAI</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" v-model="tempProvider" value="azure" class="mr-2">
                            <span class="text-sm">Azure OpenAI</span>
                        </label>
                    </div>
                </div>

                <!-- OpenAI Configuration -->
                <div v-if="tempProvider === 'openai'">
                    <label class="block text-sm font-medium text-gray-700 mb-2">OpenAI API Key</label>
                    <input 
                        type="password" 
                        v-model="tempApiKey"
                        placeholder="sk-..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm"
                    >
                </div>

                <!-- Azure Configuration -->
                <div v-if="tempProvider === 'azure'" class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Azure API Key</label>
                        <input 
                            type="password" 
                            v-model="tempApiKey"
                            placeholder="Your Azure OpenAI API key..."
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Azure Endpoint</label>
                        <input 
                            type="text" 
                            v-model="tempAzureEndpoint"
                            placeholder="https://your-resource.openai.azure.com"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Deployment Name</label>
                        <input 
                            type="text" 
                            v-model="tempAzureDeployment"
                            placeholder="gpt-4"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm"
                        >
                    </div>
                </div>

                <!-- Buttons -->
                <div class="flex space-x-3">
                    <button 
                        @click="saveApiKey"
                        class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-md transition-colors text-sm font-medium"
                    >
                        Save
                    </button>
                    <button 
                        @click="clearApiKey"
                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md transition-colors text-sm font-medium"
                    >
                        Clear
                    </button>
                </div>

                <!-- Status -->
                <div class="text-xs text-gray-600">
                    Status: <span :class="openaiApiKey ? 'text-green-600 font-medium' : 'text-red-600 font-medium'">
                        {{ getConfigStatus() }}
                    </span>
                </div>
            </div>
        </header>

        <!-- Project Management Section -->
        <section class="mb-4">
            <div class="bg-white rounded-lg shadow-md p-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <h2 class="text-lg font-bold text-purple-600">Projects</h2>
                        <span class="text-xs text-gray-500">({{ projectNames.length }})</span>
                    </div>
                    <button 
                        @click="showProjectManagement = !showProjectManagement"
                        class="text-purple-600 hover:text-purple-800 transition-colors text-sm font-medium flex items-center space-x-1"
                    >
                        <span>{{ showProjectManagement ? 'Hide' : 'Manage' }}</span>
                        <span>{{ showProjectManagement ? '▲' : '▼' }}</span>
                    </button>
                </div>
                
                <!-- Project List Input (Collapsible) -->
                <div v-if="showProjectManagement" class="mt-3 pt-3 border-t border-gray-200">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Project Names (one per line)</label>
                    <div class="flex gap-2">
                        <textarea 
                            v-model="projectListText" 
                            placeholder="Project Alpha&#10;Project Beta&#10;Project Gamma&#10;..."
                            rows="3"
                            class="flex-1 px-2 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-y text-sm"
                        ></textarea>
                        <button 
                            @click="updateProjectList"
                            class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded transition-colors text-sm font-medium h-fit"
                        >
                            Update
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- No Project Selected Message -->
        <section class="mb-4" v-if="projectNames.length === 0">
            <div class="bg-yellow-50 border border-yellow-200 rounded p-3 text-center">
                <h2 class="text-md font-semibold text-yellow-800 mb-1">No Projects Configured</h2>
                <p class="text-xs text-yellow-700">Click "Manage" above to add projects.</p>
            </div>
        </section>

        <!-- All Projects Display -->
        <div v-for="projectName in sortedProjectNames" :key="projectName" 
             class="mb-3 border border-gray-200 rounded p-2 transition-all duration-300" 
             :class="projects[projectName]?.isDone ? 'bg-green-100 border-green-300' : 'bg-gray-50'">
            
            <!-- Project Header with Input (Active Projects) -->
            <div v-if="!projects[projectName]?.isDone" class="mb-2">
                <div class="flex items-start gap-2">
                    <!-- Project Title -->
                    <div class="flex flex-col min-w-0 flex-shrink-0" style="width: 120px;">
                        <h2 class="text-sm font-bold text-gray-800 truncate">{{ projectName }}</h2>
                        <label class="flex items-center cursor-pointer mt-1">
                            <input 
                                type="checkbox" 
                                :checked="projects[projectName]?.isDone"
                                @change="toggleProjectDone(projectName)"
                                class="mr-1 h-3 w-3 text-green-600 focus:ring-green-500 border-gray-300 rounded"
                            >
                            <span class="text-xs text-gray-600">Done?</span>
                        </label>
                    </div>
                    
                    <!-- Quick Update Input -->
                    <div class="flex-1 bg-white rounded p-2 border border-gray-200">
                        <div class="flex items-start gap-2">
                            <textarea 
                                v-model="quickUpdateTexts[projectName]" 
                                @keydown.enter.ctrl="submitQuickUpdate(projectName)"
                                :disabled="isProcessing"
                                placeholder="Quick update... (Ctrl+Enter)"
                                rows="2"
                                class="flex-1 px-2 py-1 border border-gray-300 rounded text-xs focus:ring-1 focus:ring-indigo-500 focus:border-transparent resize-none disabled:opacity-50"
                            ></textarea>
                            <button 
                                @click="submitQuickUpdate(projectName)"
                                :disabled="isProcessing || !quickUpdateTexts[projectName]?.trim()"
                                class="bg-indigo-500 hover:bg-indigo-600 disabled:bg-gray-400 text-white px-2 py-1 rounded text-xs font-medium whitespace-nowrap h-fit"
                            >
                                {{ (isProcessing && currentProcessingProject === projectName) ? '⏳' : 'Add' }}
                            </button>
                        </div>
                        <div v-if="isProcessing && currentProcessingProject === projectName" class="text-xs text-gray-600 mt-1">
                            AI processing...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Project Header (Completed Projects) -->
            <div v-if="projects[projectName]?.isDone" class="flex items-center justify-between mb-2">
                <h2 class="text-sm font-bold text-gray-800">{{ projectName }}</h2>
                <label class="flex items-center cursor-pointer">
                    <input 
                        type="checkbox" 
                        :checked="projects[projectName]?.isDone"
                        @change="toggleProjectDone(projectName)"
                        class="mr-1 h-3 w-3 text-green-600 focus:ring-green-500 border-gray-300 rounded"
                    >
                    <span class="text-xs text-green-700">Done</span>
                </label>
            </div>
            
            <!-- Completed Message -->
            <div v-if="projects[projectName]?.isDone" class="mb-2 text-center text-xs text-green-700 bg-green-50 rounded p-1">
                ✅ Completed
            </div>

            <!-- Compact Project Items -->
            <div class="space-y-1 text-sm">
                <!-- Next Steps (Blue) -->
                <div v-for="(step, index) in projects[projectName]?.nextSteps || []" 
                     :key="'step-' + index"
                     class="text-blue-700 bg-blue-50 rounded px-2 py-1 border-l-2 border-blue-500">
                    {{ step }}
                </div>
                
                <!-- Achievements (Green) -->
                <div v-for="(achievement, index) in projects[projectName]?.achievements || []" 
                     :key="'achievement-' + index"
                     class="text-green-700 bg-green-50 rounded px-2 py-1 border-l-2 border-green-500">
                    {{ achievement }}
                </div>
                
                <!-- Blocking Points (Red) -->
                <div v-for="(block, index) in projects[projectName]?.blockingPoints || []" 
                     :key="'block-' + index"
                     class="text-red-700 bg-red-50 rounded px-2 py-1 border-l-2 border-red-500">
                    {{ block }}
                </div>
            </div>


        </div>

        <!-- Raw Updates Section with Dropdown -->
        <section class="mb-4" v-if="projectNames.length > 0">
            <div class="bg-white rounded shadow-md p-3">
                <div class="flex items-center space-x-3 mb-3">
                    <h2 class="text-lg font-bold text-gray-700">Raw Updates</h2>
                    <select 
                        v-model="selectedRawUpdatesProject"
                        class="px-2 py-1 border border-gray-300 rounded text-xs focus:ring-1 focus:ring-gray-500 focus:border-transparent"
                    >
                        <option value="">Select project...</option>
                        <option v-for="projectName in projectNames" :key="projectName" :value="projectName">
                            {{ projectName }}
                        </option>
                    </select>
                </div>
                
                <!-- Raw Updates Display -->
                <div v-if="selectedRawUpdatesProject && projects[selectedRawUpdatesProject]" class="space-y-1 max-h-40 overflow-y-auto">
                    <div 
                        v-for="(update, index) in projects[selectedRawUpdatesProject]?.updates || []" 
                        :key="index"
                        class="p-2 bg-gray-50 rounded border border-gray-200"
                    >
                        <p class="text-gray-800 whitespace-pre-wrap text-xs">{{ update.content }}</p>
                        <small class="text-gray-500 text-xs">{{ update.timestamp }}</small>
                    </div>
                    <div v-if="(projects[selectedRawUpdatesProject]?.updates || []).length === 0" class="text-gray-500 italic text-xs text-center py-2">
                        No updates yet for {{ selectedRawUpdatesProject }}
                    </div>
                </div>
                
                <!-- No Project Selected Message -->
                <div v-if="!selectedRawUpdatesProject" class="text-gray-500 italic text-center text-xs py-4">
                    Select a project to view raw updates
                </div>
            </div>
        </section>

        <!-- Save/Load Section -->
        <section class="mb-4">
            <div class="bg-white rounded shadow-md p-3">
                <h2 class="text-lg font-bold text-purple-600 mb-2">Data Management</h2>
                <div class="flex flex-wrap gap-2">
                    <button 
                        @click="saveData"
                        class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-xs"
                    >
                        Save
                    </button>
                    <button 
                        @click="loadData"
                        class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-xs"
                    >
                        Load
                    </button>
                    <button 
                        @click="clearData"
                        class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs"
                    >
                        Clear
                    </button>
                    <button 
                        @click="exportData"
                        class="bg-indigo-500 hover:bg-indigo-600 text-white px-3 py-1 rounded text-xs"
                    >
                        Export
                    </button>
                </div>
            </div>
        </section>
    </div>

    <script src="app.js"></script>
</body>
</html> 